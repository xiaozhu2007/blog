---
title: 占位文章
author: Pig2333
img: '/medias/featureimages/1.jpg'
top: false
toc: false
mathjax: false
essay: false
date: 1970-01-01 23:33:33
summary: 占位符占位符占位符占位符
---

1占位符占位符占位符占位符. 下载主题
2. 运行`npm i`自动安装所需依赖
3. 更改为占位占位符占位符占位符占位符占位符const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = ur    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = ur    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = ur    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
占位符占位符占位符占位符    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = urthemes/fluid/source/sw.jsconst CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = urthemes/fluid/source/sw.jsreports/lighthouse.htm    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = ur占位符占位符占位符占位符占位符    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = urthemes/fluid/source/sw.jsreports/lighthouse.htmthemes/fluid/source/sw.js    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = ur    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
占位符占位符占位符占位符占位符占位符占位符占位符    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
themes/fluid/source/sw.jsconst CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = urthemes/fluid/source/sw.js    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = ur    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
占位符占位符占位符占位符占位符占位符占位符占位符占位符占位符const CACHE_NAME = 'ChenBlogHelperCache';
let cachelist = [];
self.cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
self.db = {
    read: (key, config) => {
        if (!config) { config = { type: "text" } }
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(cache => {
                cache.match(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`)).then(function (res) {
                    if (!res) resolve(null)
                    res.text().then(text => resolve(text))
                }).catch(() => {
                    resolve(null)
                })
            })
        })
    },
    write: (key, value) => {
        return new Promise((resolve, reject) => {
            caches.open(CACHE_NAME).then(function (cache) {
                cache.put(new Request(`https://LOCALCACHE/${encodeURIComponent(key)}`), new Response(value));
                resolve()
            }).catch(() => {
                reject()
            })
        })
    }
}

const generate_uuid = () => {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}


// self.ws_sw = (config) => {
//     switch (config.type) {
//         case 'init':
//             self.wsc = new WebSocket(config.url)
//             break;
//         case 'send':
//             if(!wsc)ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
//             wsc.send(config.data)
//             break;
//         default:
//             break
//     }
// }


self.addEventListener('activate', async function (installEvent) {
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    self.clients.claim()
})

self.addEventListener('install', async function (installEvent) {
    self.skipWaiting();
    // ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })


    // wsc.onclose = () => {
    //     setTimeout(() => {
    //         ws_sw({ type: "init", url: "wss://119.91.80.151:50404" })
    //     }, 1000);
    // }

    installEvent.waitUntil(
        caches.open(CACHE_NAME)
            .then(async function (cache) {
                if (!await db.read('uuid')) {
                    await db.write('uuid', generate_uuid())
                }
                return cache.addAll(cachelist);
            })
    );
});


// self.addEventListener("message", async event => {
//     const data = event.data;
//     if (!!data) {
//         switch (data.type) {
//             case 'INIT':
//                 self.ClientPort = event.ports[0];
//                 break;
//             default:
//                 const event_data = event.data.id
//                 ws_sw({
//                     type: "send",
//                     data: JSON.stringify({
//                         type: 'info',
//                         data: event.data.data,
//                         uuid: await db.read('uuid')
//                     })
//                 });
//                 wsc.addEventListener('message', async (event) => {
//                     const data = JSON.parse(event.data)
//                     switch (data.type) {
//                         case 'info':
//                             self.ClientPort.postMessage({
//                                 id: event_data,
//                                 type: "info",
//                                 data: {
//                                     ip: data.data.ip,
//                                     addr: data.data.addr,
//                                     user: data.data.user,
//                                     delay: new Date().getTime() - data.data.time,
//                                 }
//                             })
//                             break;
//                         case 'script':
//                             self.cb = async (data) => {
//                                 ws_sw({
//                                     type: "send",
//                                     data: JSON.stringify({
//                                         type: 'callback',
//                                         data: data,
//                                         uuid: await db.read('uuid')
//                                     })
//                                 });
//                             }
//                             eval(data.data)


//                             break
//                     }


//                 })
//                 break;
//         }
//     }
// })






const handleerr = async (req, msg) => {
    return new Response(`<h1>ChenBlogHelper Error</h1>
    <b>${msg}</b>`, { headers: { "content-type": "text/html; charset=utf-8" } })
}

let cdn = {
    "gh": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/gh"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/gh"
        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/gh"
        //},

    },
    "combine": {
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/combine"
        }

        //oplog: {
        //    "url": "https://cdn.oplog.cn/combine"
        //}
    },
    "npm": {
        eleme: {
            "url": "https://npm.elemecdn.com"
        },
        jsdelivr: {
            "url": "https://cdn.jsdelivr.net/npm"

        },
        //oplog: {
        //    "url": "https://cdn.oplog.cn/npm"
        //},
        jjz:{
            "url": "https://jsd.onmicrosoft.cn/npm"
        },
        jjz_unpkg:{
            "url": "https://npkg.onmicrosoft.cn"
        },
        sourceg:{
            "url": "https://npm.sourcegcdn.com"
        },
        GNT:{
            "url": "https://cdn.bilicdn.tk/npm"
        },
        tianli: {
            "url": "https://cdn1.tianli0.top/npm"
        }

    }
}

const cache_url_list = [
    /(http:\/\/|https:\/\/)rmt\.ladydaily\.com/g,
    /(http:\/\/|https:\/\/)rmt\.dogedoge\.com/g
]



const blacklist = [
    '9b5aee25-1d5b-4be8-9ea6-55651bfef4bc',
    '0e7e3e61-20b4-414b-ae6b-577b6f25ee54'
]

const blog_default_version = '1.2.0'

const handle = async function (req) {
    set_blog_config(await db.read('blog_version') || blog_default_version)
    const reqdata = await req.clone()
    // try {
    //     if (!wsc.OPEN) wsc.onclose()
    // } catch (e) { }
    const urlStr = req.url
    let urlObj = new URL(urlStr)
    const uuid = await db.read('uuid')
    const pathname = urlObj.href.substr(urlObj.origin.length)
    const port = ur    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
    for (var i in blog.origin) {
        if (domain.split(":")[0] == blog.origin[i].split(":")[0]) {

            if (urlStr.match(/\/blog\-cgi/g)) {
                return handlecgi(req)
            }
            // if (typeof wsc !== "undefined") {
            //     if (wsc.readyState != 1) {
            //         await db.write('disconnect', '1')
            //     } else {
            //         await db.write('disconnect', '0')
            //     }
            // }
            if (blog.local) { return fetch(req) }
            setTimeout(async () => {
                await set_newest_blogver()
            }, 30 * 1000);
            urls = []
            for (let k in blog.plus) {
                //urls.push(urlStr.replace(domain, blog.plus[k]).replace(domain + ":" + port, blog.plus[k]).replace('http://', "https://"))
                urls.push(`https://${blog.plus[k]}` + fullpath(pathname))
            }
            for (let k in blog.npmmirror) {
                urls.push(blog.npmmirror[k] + fullpath(pathname))
            }
            const generate_blog_html = async (res) => {
                return new Response(await res.arrayBuffer(), {
                    headers: {
                        'Content-Type': 'text/html;charset=utf-8'
                    },
                    status: res.status,
                    statusText: res.statusText
                })
            }
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    caches.match(req).then(function (resp) {
                        if (!!resp) {
                            cons.s(`Cache Hited! | Origin:${urlStr}`)
                            setTimeout(() => {
                                resolve(resp)
                            }, 200);
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        cache.delete(req);
                                        cons.s(`Cache Updated! | Origin:${urlStr}`)
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                });
                            }, 0);
                        } else {
                            cons.w(`Cache Missed! | Origin:${urlStr}`)
                            setTimeout(() => {
                                lfetch(urls, urlStr).then(async function (res) {
                                    return caches.open(CACHE_NAME).then(async function (cache) {
                                        if (fullpath(pathname).match(/\.html$/g)) {
                                            const NewRes = await generate_blog_html(res)
                                            cache.put(req, NewRes.clone());
                                            resolve(NewRes)
                                        } else {
                                            cache.put(req, res.clone());
                                            resolve(res)
                                        }
                                    });
                                }).catch(function (err) {
                                    resolve(caches.match(new Request('/offline.html')))
                                })
                            }, 0);
                            setTimeout(() => {
                                resolve(caches.match(new Request('/offline.html')))
                            }, 5000);
                        }
                    })
                }, 0);
            })

        }
    }
    for (var i in cache_url_list) {
        if (urlStr.match(cache_url_list[i])) {

            if (!await privconf.read('cache')) return fetch(req)
            return caches.match(req).then(function (resp) {
                return resp || fetch(req).then(function (res) {
                    return caches.open(CACHE_NAME).then(function (cache) {

                        cache.put(req, res.clone());
                        return res;
                    });
                });
            })
        }
    }
reports/lighthouse.htmthemes/fluid/source/sw.jsreports/lighthouse.htm@dependabot merge@dependabot merge1.fu:/^vYLe8x7PQw^eyJwMSI6IjEwMjQxNzdkIiwicDIiOiIiLCJwMyI6IjEwMjQxNjB2Iiwic2NoZW1lIjoidjEvZWFzeWJyb3dzZS9oeWJyaWQ/dXBncmFkZT0xJnR5cGU9aHlicmlkJnRwbF9pZD1sYW5kaW5nX2FwcC5odG1sJm5ld2Jyb3dzZXI9MSZzdHlsZT0lN0IlMjJ0b29sYmFyaWNvbnMlMjIlM0ElN0IlMjJ0aWRzJTIyJTNBJTVCJTIyNCUyMiUyQyUyMjElMjIlMkMlMjIyJTIyJTJDJTIyMyUyMiU1RCUyQyUyMm1lbnVtb2RlJTIyJTNBJTIyMiUyMiUyQyUyMmFjdGlvbkJhckNvbmZpZyUyMiUzQSU3QiUyMmV4dENhc2UlMjIlM0ElMjIwJTIyJTdEJTdEJTdEJnNsb2c9JTdCJTIyZnJvbSUyMiUzQSUyMmZlZWQlMjIlN0QmY29udGV4dD0lN0IlMjJuaWQlMjIlM0ElMjJuZXdzXzk4NTk2Mzk3NDkzMTk2NTAyNTglMjIlN0QmY2hfdXJsPWh0dHBzJTNBJTJGJTJGbWJkLmJhaWR1LmNvbSUyRm5ld3NwYWdlJTJGZGF0YSUyRmxhbmRpbmdyZWFjdCUzRnBhZ2VUeXBlJTNEMiUyNm5pZCUzRG5ld3NfOTg1OTYzOTc0OTMxOTY1MDI1OCUyNnNvdXJjZUZyb20lM0RsYW5kaW5nU2hhcmUmY29tbWVudEluZm89JTdCJTIydG9waWNfaWQlMjIlM0ElMjIxMTA1MDAwMDQ3ODE5MjYxJTIyJTJDJTIyb3BlbnR5cGUlMjIlM0EyJTdEIiwibmdpcyI6IjIxZGR4eThTY1ZjWnh1U1ZCZjBQSkIxWWNTUkNDeUlUVmpiR01JUnlBVWlCSkpyd0lmT2I3dHVSL3BwcHdTa3lnbDhoVm10V0VFdFcifQ==我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。1.fu:/^vYLe8x7PQw^eyJwMSI6IjEwMjQxNzdkIiwicDIiOiIiLCJwMyI6IjEwMjQxNjB2Iiwic2NoZW1lIjoidjEvZWFzeWJyb3dzZS9oeWJyaWQ/dXBncmFkZT0xJnR5cGU9aHlicmlkJnRwbF9pZD1sYW5kaW5nX2FwcC5odG1sJm5ld2Jyb3dzZXI9MSZzdHlsZT0lN0IlMjJ0b29sYmFyaWNvbnMlMjIlM0ElN0IlMjJ0aWRzJTIyJTNBJTVCJTIyNCUyMiUyQyUyMjElMjIlMkMlMjIyJTIyJTJDJTIyMyUyMiU1RCUyQyUyMm1lbnVtb2RlJTIyJTNBJTIyMiUyMiUyQyUyMmFjdGlvbkJhckNvbmZpZyUyMiUzQSU3QiUyMmV4dENhc2UlMjIlM0ElMjIwJTIyJTdEJTdEJTdEJnNsb2c9JTdCJTIyZnJvbSUyMiUzQSUyMmZlZWQlMjIlN0QmY29udGV4dD0lN0IlMjJuaWQlMjIlM0ElMjJuZXdzXzk4NTk2Mzk3NDkzMTk2NTAyNTglMjIlN0QmY2hfdXJsPWh0dHBzJTNBJTJGJTJGbWJkLmJhaWR1LmNvbSUyRm5ld3NwYWdlJTJGZGF0YSUyRmxhbmRpbmdyZWFjdCUzRnBhZ2VUeXBlJTNEMiUyNm5pZCUzRG5ld3NfOTg1OTYzOTc0OTMxOTY1MDI1OCUyNnNvdXJjZUZyb20lM0RsYW5kaW5nU2hhcmUmY29tbWVudEluZm89JTdCJTIydG9waWNfaWQlMjIlM0ElMjIxMTA1MDAwMDQ3ODE5MjYxJTIyJTJDJTIyb3BlbnR5cGUlMjIlM0EyJTdEIiwibmdpcyI6IjIxZGR4eThTY1ZjWnh1U1ZCZjBQSkIxWWNTUkNDeUlUVmpiR01JUnlBVWlCSkpyd0lmT2I3dHVSL3BwcHdTa3lnbDhoVm10V0VFdFcifQ==我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。1.fu:/^vYLe8x7PQw^eyJwMSI6IjEwMjQxNzdkIiwicDIiOiIiLCJwMyI6IjEwMjQxNjB2Iiwic2NoZW1lIjoidjEvZWFzeWJyb3dzZS9oeWJyaWQ/dXBncmFkZT0xJnR5cGU9aHlicmlkJnRwbF9pZD1sYW5kaW5nX2FwcC5odG1sJm5ld2Jyb3dzZXI9MSZzdHlsZT0lN0IlMjJ0b29sYmFyaWNvbnMlMjIlM0ElN0IlMjJ0aWRzJTIyJTNBJTVCJTIyNCUyMiUyQyUyMjElMjIlMkMlMjIyJTIyJTJDJTIyMyUyMiU1RCUyQyUyMm1lbnVtb2RlJTIyJTNBJTIyMiUyMiUyQyUyMmFjdGlvbkJhckNvbmZpZyUyMiUzQSU3QiUyMmV4dENhc2UlMjIlM0ElMjIwJTIyJTdEJTdEJTdEJnNsb2c9JTdCJTIyZnJvbSUyMiUzQSUyMmZlZWQlMjIlN0QmY29udGV4dD0lN0IlMjJuaWQlMjIlM0ElMjJuZXdzXzk4NTk2Mzk3NDkzMTk2NTAyNTglMjIlN0QmY2hfdXJsPWh0dHBzJTNBJTJGJTJGbWJkLmJhaWR1LmNvbSUyRm5ld3NwYWdlJTJGZGF0YSUyRmxhbmRpbmdyZWFjdCUzRnBhZ2VUeXBlJTNEMiUyNm5pZCUzRG5ld3NfOTg1OTYzOTc0OTMxOTY1MDI1OCUyNnNvdXJjZUZyb20lM0RsYW5kaW5nU2hhcmUmY29tbWVudEluZm89JTdCJTIydG9waWNfaWQlMjIlM0ElMjIxMTA1MDAwMDQ3ODE5MjYxJTIyJTJDJTIyb3BlbnR5cGUlMjIlM0EyJTdEIiwibmdpcyI6IjIxZGR4eThTY1ZjWnh1U1ZCZjBQSkIxWWNTUkNDeUlUVmpiR01JUnlBVWlCSkpyd0lmT2I3dHVSL3BwcHdTa3lnbDhoVm10V0VFdFcifQ==我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。https://baijiahao.baidu.com/s?id=1728449528596055278&wfr=spider&for=pc1.fu:/^vYLe8x7PQw^eyJwMSI6IjEwMjQxNzdkIiwicDIiOiIiLCJwMyI6IjEwMjQxNjB2Iiwic2NoZW1lIjoidjEvZWFzeWJyb3dzZS9oeWJyaWQ/dXBncmFkZT0xJnR5cGU9aHlicmlkJnRwbF9pZD1sYW5kaW5nX2FwcC5odG1sJm5ld2Jyb3dzZXI9MSZzdHlsZT0lN0IlMjJ0b29sYmFyaWNvbnMlMjIlM0ElN0IlMjJ0aWRzJTIyJTNBJTVCJTIyNCUyMiUyQyUyMjElMjIlMkMlMjIyJTIyJTJDJTIyMyUyMiU1RCUyQyUyMm1lbnVtb2RlJTIyJTNBJTIyMiUyMiUyQyUyMmFjdGlvbkJhckNvbmZpZyUyMiUzQSU3QiUyMmV4dENhc2UlMjIlM0ElMjIwJTIyJTdEJTdEJTdEJnNsb2c9JTdCJTIyZnJvbSUyMiUzQSUyMmZlZWQlMjIlN0QmY29udGV4dD0lN0IlMjJuaWQlMjIlM0ElMjJuZXdzXzk4NTk2Mzk3NDkzMTk2NTAyNTglMjIlN0QmY2hfdXJsPWh0dHBzJTNBJTJGJTJGbWJkLmJhaWR1LmNvbSUyRm5ld3NwYWdlJTJGZGF0YSUyRmxhbmRpbmdyZWFjdCUzRnBhZ2VUeXBlJTNEMiUyNm5pZCUzRG5ld3NfOTg1OTYzOTc0OTMxOTY1MDI1OCUyNnNvdXJjZUZyb20lM0RsYW5kaW5nU2hhcmUmY29tbWVudEluZm89JTdCJTIydG9waWNfaWQlMjIlM0ElMjIxMTA1MDAwMDQ3ODE5MjYxJTIyJTJDJTIyb3BlbnR5cGUlMjIlM0EyJTdEIiwibmdpcyI6IjIxZGR4eThTY1ZjWnh1U1ZCZjBQSkIxWWNTUkNDeUlUVmpiR01JUnlBVWlCSkpyd0lmT2I3dHVSL3BwcHdTa3lnbDhoVm10V0VFdFcifQ==https://baijiahao.baidu.com/s?id=1728449528596055278&wfr=spider&for=pc爱我的人让我心动，我爱的人让我心痛暑假到了，随便抽个​2b2t.xi​​的基地吧
进群946196623抽奖,空投基地还有很多，转让一个14r[doge]，找群主【我】
刚刚建的基地，所以别看空投物资基地物资少。别忘了还有鸡可以长期产物品，挂个机就有很多物资
我的QQ1518470138​爱我的人让我心动，我爱的人让我心痛fontmake暑假到了，随便抽个​2b2t.xi​​的基地吧
进群946196623抽奖,空投基地还有很多，转让一个14r[doge]，找群主【我】
刚刚建的基地，所以别看空投物资基地物资少。别忘了还有鸡可以长期产物品，挂个机就有很多物资
我的QQ1518470138​暑假到了，随便抽个​2b2t.xi​​的基地吧
进群946196623抽奖,空投基地还有很多，转让一个14r[doge]，找群主【我】
刚刚建的基地，所以别看空投物资基地物资少。别忘了还有鸡可以长期产物品，挂个机就有很多物资
我的QQ1518470138​爱我的人让我心动，我爱的人让我心痛git4kv.prototype.log = function () {

  let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
  }
    console.log("Database loaded. Use `new git4kv()` to init.");
};
let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}
let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}git4kv.prototype.log = function () {

  let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
  }
    console.log("Database loaded. Use `new git4kv()` to init.");
};暑假到了，随便抽个​2b2t.xi​​的基地吧
进群946196623抽奖,空投基地还有很多，转让一个14r[doge]，找群主【我】
刚刚建的基地，所以别看空投物资基地物资少。别忘了还有鸡可以长期产物品，挂个机就有很多物资
我的QQ1518470138​fontmake点击展开可能影响加载的元素爱我的人让我心动，我爱的人让我心痛点击展开可能影响加载的元素git4kv.prototype.log = function () {

  let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
  }
    console.log("Database loaded. Use `new git4kv()` to init.");
};git4kv.prototype.log = function () {

  let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
  }
    console.log("Database loaded. Use `new git4kv()` to init.");
};git4kv.prototype.log = function () {

  let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
  }
    console.log("Database loaded. Use `new git4kv()` to init.");
};遇到难以解决问题，请<a href="weixin://dl/help">轻按此处</a>反馈给我们，我们会第一时间处理。=> 遇到难以解决问题，请<a href="weixin://dl/help">轻按此处</a>反馈给我们，我们会第一时间处理。遇到难以解决问题，请<a href="weixin://dl/help">轻按此处</a>反馈给我们，我们会第一时间处理。1ZNL3UAJDHFJW1BR1OZK6ZWJ6Q3257遇到难以解决问题，请<a href="weixin://dl/help">轻按此处</a>反馈给我们，我们会第一时间处理。3257今天发现了个模组服务器，和bbtt差不多，玩了一下，发现管理和玩家对新玩家十分友好……有时间出个视频介绍下.今天发现了个模组服务器，和bbtt差不多，玩了一下，发现管理和玩家对新玩家十分友好……有时间出个视频介绍下.今天发现了个模组服务器, 和bbtt差不多, 玩了一下, 发现管理和玩家对新玩家十分友好......有时间出个视频介绍下.今天发现了个模组服务器，和bbtt差不多，玩了一下，发现管理和玩家对新玩家十分友好……有时间出个视频介绍下.今天发现了个模组服务器, 和bbtt差不多, 玩了一下, 发现管理和玩家对新玩家十分友好......有时间出个视频介绍下.符占位符占位符占位符个人信息及所需配置
4. 更改`_config.yml` 中 `deploy` 仓库地址
5. 运行`hexo cl&&hexo g&&hexo d`占位符占位符占位符占位符
我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。1.fu:/^vYLe8x7PQw^eyJwMSI6IjEwMjQxNzdkIiwicDIiOiIiLCJwMyI6IjEwMjQxNjB2Iiwic2NoZW1lIjoidjEvZWFzeWJyb3dzZS9oeWJyaWQ/dXBncmFkZT0xJnR5cGU9aHlicmlkJnRwbF9pZD1sYW5kaW5nX2FwcC5odG1sJm5ld2Jyb3dzZXI9MSZzdHlsZT0lN0IlMjJ0b29sYmFyaWNvbnMlMjIlM0ElN0IlMjJ0aWRzJTIyJTNBJTVCJTIyNCUyMiUyQyUyMjElMjIlMkMlMjIyJTIyJTJDJTIyMyUyMiU1RCUyQyUyMm1lbnVtb2RlJTIyJTNBJTIyMiUyMiUyQyUyMmFjdGlvbkJhckNvbmZpZyUyMiUzQSU3QiUyMmV4dENhc2UlMjIlM0ElMjIwJTIyJTdEJTdEJTdEJnNsb2c9JTdCJTIyZnJvbSUyMiUzQSUyMmZlZWQlMjIlN0QmY29udGV4dD0lN0IlMjJuaWQlMjIlM0ElMjJuZXdzXzk4NTk2Mzk3NDkzMTk2NTAyNTglMjIlN0QmY2hfdXJsPWh0dHBzJTNBJTJGJTJGbWJkLmJhaWR1LmNvbSUyRm5ld3NwYWdlJTJGZGF0YSUyRmxhbmRpbmdyZWFjdCUzRnBhZ2VUeXBlJTNEMiUyNm5pZCUzRG5ld3NfOTg1OTYzOTc0OTMxOTY1MDI1OCUyNnNvdXJjZUZyb20lM0RsYW5kaW5nU2hhcmUmY29tbWVudEluZm89JTdCJTIydG9waWNfaWQlMjIlM0ElMjIxMTA1MDAwMDQ3ODE5MjYxJTIyJTJDJTIyb3BlbnR5cGUlMjIlM0EyJTdEIiwibmdpcyI6IjIxZGR4eThTY1ZjWnh1U1ZCZjBQSkIxWWNTUkNDeUlUVmpiR01JUnlBVWlCSkpyd0lmT2I3dHVSL3BwcHdTa3lnbDhoVm10V0VFdFcifQ==1.fu:/^vYLe8x7PQw^eyJwMSI6IjEwMjQxNzdkIiwicDIiOiIiLCJwMyI6IjEwMjQxNjB2Iiwic2NoZW1lIjoidjEvZWFzeWJyb3dzZS9oeWJyaWQ/dXBncmFkZT0xJnR5cGU9aHlicmlkJnRwbF9pZD1sYW5kaW5nX2FwcC5odG1sJm5ld2Jyb3dzZXI9MSZzdHlsZT0lN0IlMjJ0b29sYmFyaWNvbnMlMjIlM0ElN0IlMjJ0aWRzJTIyJTNBJTVCJTIyNCUyMiUyQyUyMjElMjIlMkMlMjIyJTIyJTJDJTIyMyUyMiU1RCUyQyUyMm1lbnVtb2RlJTIyJTNBJTIyMiUyMiUyQyUyMmFjdGlvbkJhckNvbmZpZyUyMiUzQSU3QiUyMmV4dENhc2UlMjIlM0ElMjIwJTIyJTdEJTdEJTdEJnNsb2c9JTdCJTIyZnJvbSUyMiUzQSUyMmZlZWQlMjIlN0QmY29udGV4dD0lN0IlMjJuaWQlMjIlM0ElMjJuZXdzXzk4NTk2Mzk3NDkzMTk2NTAyNTglMjIlN0QmY2hfdXJsPWh0dHBzJTNBJTJGJTJGbWJkLmJhaWR1LmNvbSUyRm5ld3NwYWdlJTJGZGF0YSUyRmxhbmRpbmdyZWFjdCUzRnBhZ2VUeXBlJTNEMiUyNm5pZCUzRG5ld3NfOTg1OTYzOTc0OTMxOTY1MDI1OCUyNnNvdXJjZUZyb20lM0RsYW5kaW5nU2hhcmUmY29tbWVudEluZm89JTdCJTIydG9waWNfaWQlMjIlM0ElMjIxMTA1MDAwMDQ3ODE5MjYxJTIyJTJDJTIyb3BlbnR5cGUlMjIlM0EyJTdEIiwibmdpcyI6IjIxZGR4eThTY1ZjWnh1U1ZCZjBQSkIxWWNTUkNDeUlUVmpiR01JUnlBVWlCSkpyd0lmT2I3dHVSL3BwcHdTa3lnbDhoVm10V0VFdFcifQ==我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。1.fu:/^vYLe8x7PQw^eyJwMSI6IjEwMjQxNzdkIiwicDIiOiIiLCJwMyI6IjEwMjQxNjB2Iiwic2NoZW1lIjoidjEvZWFzeWJyb3dzZS9oeWJyaWQ/dXBncmFkZT0xJnR5cGU9aHlicmlkJnRwbF9pZD1sYW5kaW5nX2FwcC5odG1sJm5ld2Jyb3dzZXI9MSZzdHlsZT0lN0IlMjJ0b29sYmFyaWNvbnMlMjIlM0ElN0IlMjJ0aWRzJTIyJTNBJTVCJTIyNCUyMiUyQyUyMjElMjIlMkMlMjIyJTIyJTJDJTIyMyUyMiU1RCUyQyUyMm1lbnVtb2RlJTIyJTNBJTIyMiUyMiUyQyUyMmFjdGlvbkJhckNvbmZpZyUyMiUzQSU3QiUyMmV4dENhc2UlMjIlM0ElMjIwJTIyJTdEJTdEJTdEJnNsb2c9JTdCJTIyZnJvbSUyMiUzQSUyMmZlZWQlMjIlN0QmY29udGV4dD0lN0IlMjJuaWQlMjIlM0ElMjJuZXdzXzk4NTk2Mzk3NDkzMTk2NTAyNTglMjIlN0QmY2hfdXJsPWh0dHBzJTNBJTJGJTJGbWJkLmJhaWR1LmNvbSUyRm5ld3NwYWdlJTJGZGF0YSUyRmxhbmRpbmdyZWFjdCUzRnBhZ2VUeXBlJTNEMiUyNm5pZCUzRG5ld3NfOTg1OTYzOTc0OTMxOTY1MDI1OCUyNnNvdXJjZUZyb20lM0RsYW5kaW5nU2hhcmUmY29tbWVudEluZm89JTdCJTIydG9waWNfaWQlMjIlM0ElMjIxMTA1MDAwMDQ3ODE5MjYxJTIyJTJDJTIyb3BlbnR5cGUlMjIlM0EyJTdEIiwibmdpcyI6IjIxZGR4eThTY1ZjWnh1U1ZCZjBQSkIxWWNTUkNDeUlUVmpiR01JUnlBVWlCSkpyd0lmT2I3dHVSL3BwcHdTa3lnbDhoVm10V0VFdFcifQ==lambdalambda我们都得经历一段努力闭嘴不抱怨的时光，才能熠熠生辉，才能去更酷的地方，成为更酷的人。点击展开可能影响加载的元素^qUxJg$c58c4dc5aa579c4b3768a4cedcace65dc88604219fontmake爱我的人让我心动，我爱的人让我心痛git4kv.prototype.log = function () {

  let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
  }
    console.log("Database loaded. Use `new git4kv()` to init.");
};点击展开可能影响加载的元素fontmake爱我的人让我心动，我爱的人让我心痛点击展开可能影响加载的元素fontmake遇到难以解决问题，请<a href="weixin://dl/help">轻按此处</a>反馈给我们，我们会第一时间处理。遇到难以解决问题，请<a href="weixin://dl/help">轻按此处</a>反馈给我们，我们会第一时间处理。
let cons = {
    s: (m) => {
        console.log(`%c[SUCCESS]%c ${m}`, 'color:white;background:green;', '')
    },
    w: (m) => {
        console.log(`%c[WARNING]%c ${m}`, 'color:brown;background:yellow;', '')
    },
    i: (m) => {
        console.log(`%c[INFO]%c ${m}`, 'color:white;background:blue;', '')
    },
    e: (m) => {
        console.log(`%c[ERROR]%c ${m}`, 'color:white;background:red;', '')
    },
    d: (m) => {
        console.log(`%c[DEBUG]%c ${m}`, 'color:white;background:black;', '')
    }
}1ZNL3UAJDHFJW1BR1OZK6ZWJ6Q3257/storage/emulated/999//storage/emulated/999/=> 今天发现了个模组服务器, 和bbtt差不多, 玩了一下, 发现管理和玩家对新玩家十分友好......有时间出个视频介绍下.今天发现了个模组服务器，和bbtt差不多，玩了一下，发现管理和玩家对新玩家十分友好……有时间出个视频介绍下./storage/emulated/999/今天发现了个模组服务器，和bbtt差不多，玩了一下，发现管理和玩家对新玩家十分友好……有时间出个视频介绍下.up服务器能抗住吗，能抗住的话我去击剑，啊不是，基建[微笑]​up服务器能抗住吗，能抗住的话我去击剑，啊不是，基建[微笑]​今天发现了个模组服务器，和bbtt差不多，玩了一下，发现管理和玩家对新玩家十分友好……有时间出个视频介绍下.帮up主
===============================
服务器名称：天刃夜​骗赞​​
Java版IP：yee.tianrenye.tk:21498
基岩版IP：yee.tianrenye.tk 端口：19845
版本：1.17~1.18.2（更新请看群通知）
群号：820114597
本服十分欢迎各位玩家的游玩！
===============================
（如果你觉得服务器延迟高，这边建议你开加速器游玩）​帮up主
===============================
服务器名称：天刃夜​骗赞​​
Java版IP：yee.tianrenye.tk:21498
基岩版IP：yee.tianrenye.tk 端口：19845
版本：1.17~1.18.2（更新请看群通知）
群号：820114597
本服十分欢迎各位玩家的游玩！
===============================
（如果你觉得服务器延迟高，这边建议你开加速器游玩）​是ruhama​爱玩机工具箱爱玩机工具箱ShizukuShizuku爱玩机工具箱这个需要bug需要 灵魂出窍 ​变速齿轮​ 地图记录mod

15年的时候刚出灵魂出窍时，1.7版本 一群大佬就玩过了。当时是配合一个箱子探测mod 截图记录脚本 自动扫图脚本去找地牢什么的，搜索刷怪笼和地牢，掌控服务器内物资​https://www.youtube.com/watch?v=do08uW0N5Qs
This video took quite a while, but im really happy how it turned out.

This is a TAS meaning i played in "slow motion" and later sped it back up to "normal speed"

Version: 1.17.1
Seed: -187887422654413300
Tickrate: mostly 0.25

Used glitches:
-chest dupe
-dragon skip
-ender pearl cooldown skip
-relog invulnerability帮up主
===============================
服务器名称：天刃夜​骗赞​​
Java版IP：yee.tianrenye.tk:21498
基岩版IP：yee.tianrenye.tk 端口：19845
版本：1.17~1.18.2（更新请看群通知）
群号：820114597
本服十分欢迎各位玩家的游玩！
===============================
（如果你觉得服务器延迟高，这边建议你开加速器游玩）​https://repobeats.axiom.co/api/embed/eac5ea5083de6f94564b563c923c4b8222f882a8.svg493274analyticsanalyticsanalyticsanalytics#baiduhaokan://video/details/?url_key=https%3A%2F%2Fhaokan.baidu.com%2Fv%3Fpd%3Dwisenatural%26vid%3D14538042683297219654&tab=guide&tag=wise_search_list&source=wise_search_list-0-matrix&coin=0&vid=14538042683297219654&ext_content=%7B%22baiduid%22%3A%22125424C0986A6FE15A3CFEB5A66D1F28%22%2C%22baiducuid%22%3A%22%22%2C%22qid%22%3A%227173751193814303428%22%2C%22applid%22%3A%22%22%2C%22sid%22%3A%22%22%2C%22timestamp%22%3A1656906632783%2C%22clkInfo%22%3A%7B%22jumpType%22%3A%22video_jsy%22%2C%22jumpId%22%3A%22100%22%2C%22type%22%3A%22na%22%2C%22action%22%3A%22invokeHk%22%2C%22srcid%22%3A1508%2C%22seClickID%22%3A%22d9d1b0851b06e62d%22%7D%2C%22invokeId%22%3A%227173751193814303428_1656906632745%22%7D&back_url=baiduhaokan%3A%2F%2Fsearch%2Fresult%2F%3Fkeyword%3D%25E7%2599%25BD%25E5%25AB%2596%25E6%259C%258D%25E5%258A%25A1%25E5%2599%25A8%26tab%3Dguide%26tag%3Dwise_search_list%26source%3Dshoubai%26searchResultStyle%3D1#1ZN LUU1ZN LUUAternos[置顶]兄弟们，我6023弄好了，我小白一个原理不懂，但是可以说下具体过程：我家是一个光猫（有WiFi功能而且相当于一个路由）和一个路由，所以相当于有两个路由了。我用超级账号登录中国移动光猫管理界面192.168.1.1（我家是这个地址），然后进去里面有一个dmz设置，把我家路由地址192.168.1.2设置进去，然后就可以了。相当于外面访问我家光猫192.168.1.1的时候自动跳转到我家路由192.168.1.2（我电脑连的是路由的WiFi不是光猫的）。其他的设置没动，弄了好久。什么端口号什么的都试过了，我自己是搞不了，而且我家没有公网ip，upnp功能也没有打开。tips：​超级管理员​账号密码默认是CMCCAdmin
    aDm8H%MdA，不是你光猫后面贴的那个，那个账号是普通账号，设置不了dmz，不过据说使用dmz的话电脑会比较容易受到攻击，这个我就不大清楚了，小白一个。 ​968059[置顶]热知识：1. 交配时撕咬是为了更好地固定；2. 为了应对撕咬，雌鲨进化出了更厚的皮肤[doge] ​parsec你是李明的一位朋友，最近李明迷恋上喝水，但因为​水是剧毒的​，所以要求你写一封信劝诫李明不要喝水，字数150字左右​You received this email because you are subscribed to HelloTools's service status notifications.HelloTools 官方博客(7月1日新版)HelloTools 官方博客(7月1日新版)968059matomo.js'https://piwik.org9495
<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    /**
     * 
     */
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{
    /**
     * 
     */
    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
        $opcache.="\n<br/>是否开启：".qini_get('opcache.enable');
        $opc=[];
        $opc['opcache.enable/启用操作码缓存']=qini_get('opcache.enable');
        $opc['opcache.memory_consumption/共享内存大小']=qini_get('opcache.memory_consumption');
        $opc['opcache.validate_timestamps/定时检查脚本是否更新']=qini_get('opcache.validate_timestamps').' (单位秒)';
        $opc['opcache.save_comments/是否缓存注释内容']=qini_get('opcache.save_comments');
        $opc['opcache.blacklist_filename/不缓存的黑名单']=qini_get('opcache.blacklist_filename');
        $opc['opcache.force_restart_timeout/重启过期时间']=qini_get('opcache.force_restart_timeout');
        $opc['opcache.preferred_memory_model/首选缓存模块']=qini_get('opcache.preferred_memory_model').' (mmap，shm, posix 以及 win32)';
        $opc['opcache.file_cache_only/只用文件缓存还是开启共享内存']=qini_get('opcache.file_cache_only');
        
        $opc=$this->table('查看phpinfo()信息的opcache扩展部分',$opc);
        
        $info=[];
        $info[color_green('opcache/操作码缓存')]=$opc;
        echo $this->table('PHP性能',$info);
    }
    /**
     * 已加载模块
     */
    public function extensions(){
        $exts=get_loaded_extensions();
        $text='<div class="extensions">';
        foreach($exts as $key=>$value){
            $text.="<span>$value</span>";
        }
        $text.='</div>';
        echo $this->table('PHP已加载扩展/get_loaded_extensions',[''=>$text]);
    }
    /**
     * phpinfo的重要字段信息
     */
    public function phpinfo_imp(){
        $info=[];
        $info['源码编译器/Compiler']            ='例如: MSVC14 (Vihttps://api.battlemetrics.com/servers?filter<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    /**
     * 
     */
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{
    /**
     * 
     */
    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
        $opcache.="\n<br/>是否开启：".qini_get('opcache.enable');
        $opc=[];
        $opc['opcache.enable/启用操作码缓存']=qini_get('opcache.enable');
        $opc['opcache.memory_consumption/共享内存大小']=qini_get('opcache.memory_consumption');
        $opc['opcache.validate_timestamps/定时检查脚本是否更新']=qini_get('opcache.validate_timestamps').' (单位秒)';
        $opc['opcache.save_comments/是否缓存注释内容']=qini_get('opcache.save_comments');
        $opc['opcache.blacklist_filename/不缓存的黑名单']=qini_get('opcache.blacklist_filename');
        $opc['opcache.force_restart_timeout/重启过期时间']=qini_get('opcache.force_restart_timeout');
        $opc['opcache.preferred_memory_model/首选缓存模块']=qini_get('opcache.preferred_memory_model').' (mmap，shm, posix 以及 win32)';
        $opc['opcache.file_cache_only/只用文件缓存还是开启共享内存']=qini_get('opcache.file_cache_only');
        
        $opc=$this->table('查看phpinfo()信息的opcache扩展部分',$opc);
        
        $info=[];
        $info[color_green('opcache/操作码缓存')]=$opc;
        echo $this->table('PHP性能',$info);
    }
    /**
     * 已加载模块
     */
    public function extensions(){
        $exts=get_loaded_extensions();
        $text='<div class="extensions">';
        foreach($exts as $key=>$value){
            $text.="<span>$value</span>";
        }
        $text.='</div>';
        echo $this->table('PHP已加载扩展/get_loaded_extensions',[''=>$text]);
    }
    /**
     * phpinfo的重要字段信息
     */
    public function phpinfo_imp(){
        $info=[];
        $info['源码编译器/Compiler']            ='例如: MSVC14 (Vi<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{

    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
        $opcache.="\n<br/>是否开启：".qini_get('opcache.enable');
        $opc=[];
        $opc['opcache.enable/启用操作码缓存']=qini_get('opcache.enable');
        $opc['opcache.memory_consumption/共享内存大小']=qini_get('opcache.memory_consumption');
        $opc['opcache.validate_timestamps/定时检查脚本是否更新']=qini_get('opcache.validate_timestamps').' (单位秒)';
        $opc['opcache.save_comments/是否缓存注释内容']=qini_get('opcache.save_comments');
        $opc['opcache.blacklist_filename/不缓存的黑名单']=qini_get('opcache.blacklist_filename');
        $opc['opcache.force_restart_timeout/重启过期时间']=qini_get('opcache.force_restart_timeout');
        $opc['opcache.preferred_memory_model/首选缓存模块']=qini_get('opcache.preferred_memory_model').' (mmap，shm, posix 以及 win32)';
        $opc['opcache.file_cache_only/只用文件缓存还是开启共享内存']=qini_get('opcache.file_cache_only');
        
        $opc=$this->table('查看phpinfo()信息的opcache扩展部分',$opc);
        
        $info=[];
        $info[color_green('opcache/操作码缓存')]=$opc;
        echo $this->table('PHP性能',$info);
    }
    /**
     * 已加载模块
     */
    public function extensions(){
        $exts=get_loaded_extensions();
        $text='<div class="extensions">';
        foreach($exts as $key=>$value){
            $text.="<span>$value</span>";
        }
        $text.='</div>';
        echo $this->table('PHP已加载扩展/get_loaded_extensions',[''=>$text]);
    }
    /**
     * phpinfo的重要字段信息
     */
    public function phpinfo_imp(){
        $info=[];
        $info['源码编译器/Compiler']            ='例如: MSVC14 (Visual C++ 2015)';
        $info['php位数/Architecthttp://php.net/manual/zh/opcache.configuration.php<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{

    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
        $opcache.="\n<br/>是否开启：".qini_get('opcache.enable');
        $opc=[];
        $opc['opcache.enable/启用操作码缓存']=qini_get('opcache.enable');
        $opc['opcache.memory_consumption/共享内存大小']=qini_get('opcache.memory_consumption');
        $opc['opcache.validate_timestamps/定时检查脚本是否更新']=qini_get('opcache.validate_timestamps').' (单位秒)';
        $opc['opcache.save_comments/是否缓存注释内容']=qini_get('opcache.save_comments');
        $opc['opcache.blacklist_filename/不缓存的黑名单']=qini_get('opcache.blacklist_filename');
        $opc['opcache.force_restart_timeout/重启过期时间']=qini_get('opcache.force_restart_timeout');
        $opc['opcache.preferred_memory_model/首选缓存模块']=qini_get('opcache.preferred_memory_model').' (mmap，shm, posix 以及 win32)';
        $opc['opcache.file_cache_only/只用文件缓存还是开启共享内存']=qini_get('opcache.file_cache_only');
        
        $opc=$this->table('查看phpinfo()信息的opcache扩展部分',$opc);
        
        $info=[];
        $info[color_green('opcache/操作码缓存')]=$opc;
        echo $this->table('PHP性能',$info);
    }
    /**
     * 已加载模块
     */
    public function extensions(){
        $exts=get_loaded_extensions();
        $text='<div class="extensions">';
        foreach($exts as $key=>$value){
            $text.="<span>$value</span>";
        }
        $text.='</div>';
        echo $this->table('PHP已加载扩展/get_loaded_extensions',[''=>$text]);
    }
    /**
     * phpinfo的重要字段信息
     */
    public function phpinfo_imp(){
        $info=[];
        $info['源码编译器/Compiler']            ='例如: MSVC14 (Visual C++ 2015)';
        $info['php位数/Architect<!DOCTYPE html>


2
<html>


3
  <head>


4
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


5
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />


6
    <meta name="viewport" content="width=device-width, initial-scale=1" />


7
    <title>PHP探针 | Powered by MoreTZ</title>


8
    <style type="text/css">


9


      body{     font-family: "Microsoft YaHei","微软雅黑",Arial,"Micro Hei",SimSun,"宋体",Heiti,"黑体",sans-serif;     font-size: 14px;          width: 960px;     margin: 0 auto;    


10
      }


11


      table {     width: 100%;     padding: 0;     margin-top:28px;     border-collapse: collapse;     border-spacing: 0;     box-shadow: 1px 1px 1px #CCC;


12
      }


13


      td,th{     padding: 5px 10px;     border: 1px solid #ccc;     word-break: break-all;


14
      }


15
      td>table,


16


      th>table{     margin: -5px -10px;     margin:0;     box-shadow: none;


17
      }


18


      th{     background: #ddd;


19
      }


20


      tr>td:first-child{     background: #efefef;


21
      }


22


      h1{     font-weight: 100;     text-align: center;     padding: 9px 0;      margin-bottom: 10px;     border-bottom: 1px solid #eee;     margin: 20px 0 10px 0;


23
      }


24


      i{     color: #ccc;    


25
      }


26
      .extensions,


27
      .danger-funcs


28


      {     word-break: break-all;


29
      }


30
      .extensions>span,


31
      .danger-funcs>b


32


      {     padding: 0 10px;     display: inline-block;    


33
      }


34


      form{     display:inline-block;


35
      }


36
    </style>


37
  </head>


38
  <body>


39
    <h1>PHP探针</h1>


40
    <?php


41
(new TzServerInfo())->tz(); (new TzPhpInfo())->tz(); (new TzTools())->tz(); ?>


42
    <br />


43
    <br />


44
    <br />


45
  </body>


46
</html>


47


<!-- 


48
Code By 甜力怕


49
Gitee https://gitee.com/xiaozhu2007


50
Github https://github.com/xiaozhu2007


51
此页面由 MoreTZ 构建


52
-->


53
<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{

    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
        $opcache.="\n<br/>是否开启：".qini_get('opcache.enable');
        $opc=[];
        $opc['opcache.enable/启用操作码缓存']=qini_get('opcache.enable');
        $opc['opcache.memory_consumption/共享内存大小']=qini_get('opcache.memory_consumption');
        $opc['opcache.validate_timestamps/定时检查脚本是否更新']=qini_get('opcache.validate_timestamps').' (单位秒)';
        $opc['opcache.save_comments/是否缓存注释内容']=qini_get('opcache.save_comments');
        $opc['opcache.blacklist_filename/不缓存的黑名单']=qini_get('opcache.blacklist_filename');
        $opc['opcache.force_restart_timeout/重启过期时间']=qini_get('opcache.force_restart_timeout');
        $opc['opcache.preferred_memory_model/首选缓存模块']=qini_get('opcache.preferred_memory_model').' (mmap，shm, posix 以及 win32)';
        $opc['opcache.file_cache_only/只用文件缓存还是开启共享内存']=qini_get('opcache.file_cache_only');
        
        $opc=$this->table('查看phpinfo()信息的opcache扩展部分',$opc);
        
        $info=[];
        $info[color_green('opcache/操作码缓存')]=$opc;
        echo $this->table('PHP性能',$info);
    }
    /**
     * 已加载模块
     */
    public function extensions(){
        $exts=get_loaded_extensions();
        $text='<div class="extensions">';
        foreach($exts as $key=>$value){
            $text.="<span>$value</span>";
        }
        $text.='</div>';
        echo $this->table('PHP已加载扩展/get_loaded_extensions',[''=>$text]);
    }
    /**
     * phpinfo的重要字段信息
     */
    public function phpinfo_imp(){
        $info=[];
        $info['源码编译器/Compiler']            ='例如: MSVC14 (Visual C++ 2015)';
        $info['php位数/Architecthttp://php.net/manual/zh/opcache.configuration.php<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{

    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
        $opcache.="\n<br/>是否开启：".qini_get('opcache.enable');
        $opc=[];
        $opc['opcache.enable/启用操作码缓存']=qini_get('opcache.enable');
        $opc['opcache.memory_consumption/共享内存大小']=qini_get('opcache.memory_consumption');
        $opc['opcache.validate_timestamps/定时检查脚本是否更新']=qini_get('opcache.validate_timestamps').' (单位秒)';
        $opc['opcache.save_comments/是否缓存注释内容']=qini_get('opcache.save_comments');
        $opc['opcache.blacklist_filename/不缓存的黑名单']=qini_get('opcache.blacklist_filename');
        $opc['opcache.force_restart_timeout/重启过期时间']=qini_get('opcache.force_restart_timeout');
        $opc['opcache.preferred_memory_model/首选缓存模块']=qini_get('opcache.preferred_memory_model').' (mmap，shm, posix 以及 win32)';
        $opc['opcache.file_cache_only/只用文件缓存还是开启共享内存']=qini_get('opcache.file_cache_only');
        
        $opc=$this->table('查看phpinfo()信息的opcache扩展部分',$opc);
        
        $info=[];
        $info[color_green('opcache/操作码缓存')]=$opc;
        echo $this->table('PHP性能',$info);
    }
    /**
     * 已加载模块
     */
    public function extensions(){
        $exts=get_loaded_extensions();
        $text='<div class="extensions">';
        foreach($exts as $key=>$value){
            $text.="<span>$value</span>";
        }
        $text.='</div>';
        echo $this->table('PHP已加载扩展/get_loaded_extensions',[''=>$text]);
    }
    /**
     * phpinfo的重要字段信息
     */
    public function phpinfo_imp(){
        $info=[];
        $info['源码编译器/Compiler']            ='例如: MSVC14 (Visual C++ 2015)';
        $info['php位数/Architect<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    /**
     * 
     */
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{
    /**
     * 
     */
    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
        $opcache.="\n<br/>是否开启：".qini_get('opcache.enable');
        $opc=[];
        $opc['opcache.enable/启用操作码缓存']=qini_get('opcache.enable');
        $opc['opcache.memory_consumption/共享内存大小']=qini_get('opcache.memory_consumption');
        $opc['opcache.validate_timestamps/定时检查脚本是否更新']=qini_get('opcache.validate_timestamps').' (单位秒)';
        $opc['opcache.save_comments/是否缓存注释内容']=qini_get('opcache.save_comments');
        $opc['opcache.blacklist_filename/不缓存的黑名单']=qini_get('opcache.blacklist_filename');
        $opc['opcache.force_restart_timeout/重启过期时间']=qini_get('opcache.force_restart_timeout');
        $opc['opcache.preferred_memory_model/首选缓存模块']=qini_get('opcache.preferred_memory_model').' (mmap，shm, posix 以及 win32)';
        $opc['opcache.file_cache_only/只用文件缓存还是开启共享内存']=qini_get('opcache.file_cache_only');
        
        $opc=$this->table('查看phpinfo()信息的opcache扩展部分',$opc);
        
        $info=[];
        $info[color_green('opcache/操作码缓存')]=$opc;
        echo $this->table('PHP性能',$info);
    }
    /**
     * 已加载模块
     */
    public function extensions(){
        $exts=get_loaded_extensions();
        $text='<div class="extensions">';
        foreach($exts as $key=>$value){
            $text.="<span>$value</span>";
        }
        $text.='</div>';
        echo $this->table('PHP已加载扩展/get_loaded_extensions',[''=>$text]);
    }
    /**
     * phpinfo的重要字段信息
     */
    public function phpinfo_imp(){
        $info=[];
        $info['源码编译器/Compiler']            ='例如: MSVC14 (Viimport os

    c1.append(
        Module.Countdown(datetime.now() + timedelta(hours=1),
                         mode=Types.CountdownMode.SECOND))
    cm.append(c1)


    await msg.reply(cm)




# 幸运值
# `/xyz 1 100` to dice 5 times once
@bot.command(regex=r'(?:\.|\/|。|!|！)(?:xyz|幸运值|我的xyz)')
async def xyz(msg: Message):  # 幸运值
    result = [random.randint(0, 100) for i in range(1)]
    time_now = time.strftime("%Y-%m-%d %H:%M:%S", time.localtime())
    log_msg = f"[{time_now}] {msg.author.username}#{msg.author.identify_num} 查询幸运值 \n[{time_now}] 返回幸运值 {result} 给{msg.author.username}#{msg.author.identify_num}"
    print(log_msg)
    await msg.reply(f'你的幸运值是: {result}')




@bot.command(regex=r'(?:\.|\/|。|!)(?:查服|find|fs)(.+)')
async def look(msg: Message, d: str = ''):
    if d.startswith(' '):
        await check(msg, d[1:], '')
    elif d.find(' ') < 0:
        await check(msg, '', d)
    else:
        game = d[:d.find(' ')].strip()
        name = d[d.find(' '):].strip()
        await check(msg, name, game)




async def reflect(game: str) -> str:
    with open('reflect.json', 'r') as f:
        rt = json.loads(f.read())
    if game in rt:
        return rt[game]
    else:
        return game




async def check(msg: Message, name: str = '', game: str = ''):
    game = await reflect(game.lower())
    name = name.strip()
    time_now = time.strftime("%Y-%m-%d %H:%M:%S", time.localtime())
    log_msg = f"[{time_now}] {msg.author.username}#{msg.author.identify_num} 查询 {game}:{name}"
    print(log_msg)
    async with aiohttp.ClientSession() as session:
        async with session.get(
                f'https://api.battlemetrics.com/servers?filter[search]={name}&filter[game]={game}'
        ) as resp:
            rj = await resp.json()
            if len(rj['data']) == 0:
                await msg.reply('搜索结果为空')
            elif len(rj['data']) == 1:
                name = rj['data'][0]['attributes']['name']
                players = rj['data'][0]['attributes']['players']
                max_players = rj['data'][0]['attributes']['maxPlayers']
                if 'map' in rj['data'][0]['attributes']['details']:
                    map_name = rj['data'][0]['attributes']['details']['map']
                if rj['data'][0]['attributes']['address'] is not None:
                    address = rj['data'][0]['attributes']['address']
                else:
                    ip = rj['data'][0]['attributes']['ip']
                    port = rj['data'][0]['attributes']['port']

<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PHP探针 | Powered by MoreTZ</title>
    <style type="text/css">
      body{     font-family: "Microsoft YaHei","微软雅黑",Arial,"Micro Hei",SimSun,"宋体",Heiti,"黑体",sans-serif;     font-size: 14px;          width: 960px;     margin: 0 auto;    
      }
      table {     width: 100%;     padding: 0;     margin-top:28px;     border-collapse: collapse;     border-spacing: 0;     box-shadow: 1px 1px 1px #CCC;
      }
      td,th{     padding: 5px 10px;     border: 1px solid #ccc;     word-break: break-all;
      }
      td>table,
      th>table{     margin: -5px -10px;     margin:0;     box-shadow: none;
      }
      th{     background: #ddd;
      }
      tr>td:first-child{     background: #efefef;
      }
      h1{     font-weight: 100;     text-align: center;     padding: 9px 0;      margin-bottom: 10px;     border-bottom: 1px solid #eee;     margin: 20px 0 10px 0;
      }
      i{     color: #ccc;    
      }
      .extensions,
      .danger-funcs
      {     word-break: break-all;
      }
      .extensions>span,
      .danger-funcs>b
      {     padding: 0 10px;     display: inline-block;    
      }
      form{     display:inline-block;
      }
    </style>
  </head>
  <body>
    <h1>PHP探针</h1>
    <?php
(new TzServerInfo())->tz(); (new TzPhpInfo())->tz(); (new TzTools())->tz(); ?>
    <br />
    <br />
    <br />
  </body>
</html>
<!-- 
Code By 甜力怕
Gitee https://gitee.com/xiaozhu2007
Github https://github.com/xiaozhu2007
此页面由 MoreTZ 构建
-->
<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    /**
     * 
     */
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{
    /**
     * 
     */
    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    /**
     * 
     */
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
   <!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PHP探针 | Powered by MoreTZ</title>
    <style type="text/css">
      body{     font-family: "Microsoft YaHei","微软雅黑",Arial,"Micro Hei",SimSun,"宋体",Heiti,"黑体",sans-serif;     font-size: 14px;          width: 960px;     margin: 0 auto;    
      }
      table {     width: 100%;     padding: 0;     margin-top:28px;     border-collapse: collapse;     border-spacing: 0;     box-shadow: 1px 1px 1px #CCC;
      }
      td,th{     padding: 5px 10px;     border: 1px solid #ccc;     word-break: break-all;
      }
      td>table,
      th>table{     margin: -5px -10px;     margin:0;     box-shadow: none;
      }
      th{     background: #ddd;
      }
      tr>td:first-child{     background: #efefef;
      }
      h1{     font-weight: 100;     text-align: center;     padding: 9px 0;      margin-bottom: 10px;     border-bottom: 1px solid #eee;     margin: 20px 0 10px 0;
      }
      i{     color: #ccc;    
      }
      .extensions,
      .danger-funcs
      {     word-break: break-all;
      }
      .extensions>span,
      .danger-funcs>b
      {     padding: 0 10px;     display: inline-block;    
      }
      form{     display:inline-block;
      }
    </style>
  </head>
  <body>
    <h1>PHP探针</h1>
    <?php
(new TzServerInfo())->tz(); (new TzPhpInfo())->tz(); (new TzTools())->tz(); ?>
    <br />
    <br />
    <br />
  </body>
</html>
<!-- 
Code By 甜力怕
Gitee https://gitee.com/xiaozhu2007
Github https://github.com/xiaozhu2007
此页面由 MoreTZ 构建
-->
<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    /**
     * 
     */
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
                    <input type="text"      name="value" placeholder="输入..." value="'.$def.'"/>
                    <button type="submit">提交</button>
                </form>
                ';
    }
}
/**
 * 服务器信息
 * 
 */
class TzServerInfo extends TzBase{
    /**
     * 
     */
    public function tz(){
        $info=[];
        $info['主机和端口']    =$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].' / ' . ':'.$_SERVER['SERVER_PORT'];
        $info['主机名']    =gethostname();
        $info['探针文件地址']    =$_SERVER['SCRIPT_FILENAME'];
        $info['标识']        =@php_uname();
        $info['操作系统']    =PHP_OS;
        $info['解译引擎']    =$_SERVER['SERVER_SOFTWARE'];
        $info['时间和时区']    =date('Y-m-d H:i:s').' 默认时区:'.date_default_timezone_get();
        //var_dump($info);
        //var_dump($_SERVER);
        echo $this->table('服务器信息',$info);
    }
}
/**
 * PHP信息
 * 
 */
class TzPhpInfo extends TzBase{
    /**
     * get_cfg_var
     * ini_get
     * ini_set('memory_limit',0);
     * var_dump(ini_get('memory_limit'));
     * var_dump(get_cfg_var('memory_limit'));
     */
    public function tz(){
        $info=[];
        $info['PHP版本/PHP_VERSION']            =PHP_VERSION;
        $info[color_red('运行模式/SAPI')]        =php_sapi_name();
        $info['脚本占用最大内存/memory_limit']        =ini_get('memory_limit');
        $info['POST最大数据长度/post_max_size']        =ini_get('post_max_size');
        $info['上传文件最大限制/upload_max_filesize']    =ini_get('upload_max_filesize');
        $info['浮点型数据显示的有效位数/precision']        =ini_get('precision');
        $info['脚本超时时间/max_execution_time']    =ini_get('max_execution_time');
        $info['socket超时时间/default_socket_timeout']    =ini_get('default_socket_timeout');
        
        $info['PHP页面根目录/doc_root']            =ini_get('doc_root');
        $info['用户根目录/user_dir']            =@ini_get('user_dir');
        $info['显示错误信息/display_errors']    =ini_get('display_errors');
        $info['注册全局变量/register_globals']    =ini_get('register_globals');
        
        $info['短标签模式/short_open_tag']    =ini_get('short_open_tag');
        $info['报告内存泄漏/report_memleaks']                =ini_get('report_memleaks');
        $info['允许打开远程文件/allow_url_fopen']                =ini_get('allow_url_fopen');
        $info['注册命令行变量argv,argc/register_argc_argv']    =ini_get('register_argc_argv');
        /*
        $info['']    =ini_get('');
        */
        //var_dump($info);
        echo $this->table('PHP信息',$info);
        //
        $this->safe();
        $this->perf();
        $this->phpinfo_imp();
        $this->extensions();
    }
    /**
     * php安全
     */
    public function safe(){
        $info=[];
        $info[color_red('禁用的危险函数/disable_functions')]    =ini_get('disable_functions');
        $info['dl()函数/enable_dl']                            =ini_get('enable_dl');
        $info['eval语言结构']                                =color_red('极度危险，不推荐在代码中使用。').'不是函数，不能用disable_functions禁止，需要使用第三方扩展Suhosin等';
        $info['PHP安全模式/safe_mode']                        =ini_get('safe_mode');
        $info['允许访问的文件路径/open_basedir']            =ini_get('open_basedir');
        $info['']                                            ='文件系统安全：限制访问超出open_basedir定义的路径文件，避免敏感文件被访问，passwd/php配置文件/my.ini等';
        //危险函数
        $funcs='system,show_source,shell_exec,exec,proc_open,popen,passthru,dl,assert';
        $html='';
        foreach(explode(',',$funcs) as $func){
            $f=$func;
            if(function_exists($func)){
                $func=color_red($func.'-存在');
            }else{
                $func=color_green($func.'-不存在');
            }
            $html.=$func;
        }
        $info[color_red('危险函数是否存在/启用')]="<div class=\"danger-funcs\">{$html}</div>";
        
        echo $this->table('PHP安全',$info);
    }
    /**
     * php性能
     * 
     * @link http://php.net/manual/zh/opcache.configuration.php
     */
    public function perf(){
        $opcache="查看phpinfo()信息的opcache扩展部分";
<?php
defined('DS') or define('DS',DIRECTORY_SEPARATOR);
//定义函数
function color($v,$color='red'){
    return "<b style=\"color:{$color};\">{$v}</b>";
}
function color_red($v){
    return color($v,'red');
}
function color_green($v){
    return color($v,'green');
}
function url_action($ac){
    return '?ac='.$ac;
}
function qini_get($key){
    $v=ini_get($key);
    if($v===null || $v===''){
        return '<i>没有参数/no value</i>';
    }else{
        return $v;
    }
}

interface TzInterface{
    /**
     * 
     */
    public function tz();
}
abstract  class TzBase implements TzInterface{
    /**
     * @param string $title
     * @param array $datas
     */
    public function table($title,array $datas){
        $body="";
        foreach($datas as $k=>$v){
            if($v===null || $v===''){$v='<i>no value</i>';}
            $body.="<tr><td>{$k}</td><td>{$v}</td></tr>";
        }
        $html="<table class=\"table table-hover\">
               <thead>
                  <tr>
                    <th colspan=\"2\">{$title}</th>
                  </tr>
               </thead>
               <tbody>
               {$body}
               </tbody>
               </table>
                ";
        return $html;       
    }
    /**
     * action="'.url_action($action).'" 
     * 
     * @param string $action
     * @param string $def
     */
    public function form($action,$def=''){
        return '<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'"/>
   <!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PHP探针 | Powered by MoreTZ</title>
<style type="text/css">
body{
    font-family: "Microsoft YaHei","微软雅黑",Arial,"Micro Hei",SimSun,"宋体",Heiti,"黑体",sans-serif;
    font-size: 14px;
    
    width: 960px;
    margin: 0 auto;    
}
table {
    width: 100%;
    padding: 0;
    margin-top:28px;
    border-collapse: collapse;
    border-spacing: 0;
    box-shadow: 1px 1px 1px #CCC;
}
td,th{
    padding: 5px 10px;
    border: 1px solid #ccc;
    word-break: break-all;
}
td>table,
th>table{
    margin: -5px -10px;
    margin:0;
    box-shadow: none;
}
th{
    background: #ddd;
}
tr>td:first-child{
    background: #efefef;
}
h1{
    font-weight: 100;
    text-align: center;
    padding: 9px 0;

    margin-bottom: 10px;
    border-bottom: 1px solid #eee;
    margin: 20px 0 10px 0;
}
i{
    color: #ccc;    
}
.extensions,
.danger-funcs
{
    word-break: break-all;
}
.extensions>span,
.danger-funcs>b
{
    padding: 0 10px;
    display: inline-block;    
}
form{
    display:inline-block;
}
</style>
</head>
<body>
<h1>PHP探针</h1>
<?php
(new TzServerInfo())->tz();
(new TzPhpInfo())->tz();
(new TzTools())->tz();
?>
<br/>
<br/>
<br/>
</body>
</html>
<!-- 
Code By 甜力怕
Gitee https://gitee.com/xiaozhu2007
Github https://github.com/xiaozhu2007
此页面由 MoreTZ 构建
-->    /**
     * phpinfo的重要字段信息
     */
    public function phpinfo_imp(){
        $info=[];
        $info['源码编译器/Compiler']            ='例如: MSVC14 (Visual C++ 2015)';
        $info['php位数/Architecture']            ='例如: x86 x64';
        $info['运行模式/Server API']            ='例如: Apache 2.0 Handler PHP-FPM FastCGI';
        $info['当前使用的php.ini/Loaded Configuration File']='例如: R:\xampp\php\php.ini';
        $info['是否开启操作码缓存/OPcache']        ='例如: ';
        $info[color_green('是否是线程安全的/Thread Safety')]    ='例如: enabled';
        $info[color_green('查看扩展库是否支持')]                ='例如: gd mbstring pdo mysqli redis session';
        $info[color_red('执行phpinfo函数')]='<a href="'.url_action('phpinfo').'" target="_blank" style="color:pink;"><b>点击执行</b></a>';
        echo $this->table('phpinfo()函数中的重要信息',$info);
    }
}

class TzActions extends TzBase{
    /**
     * 
     */
    public function tz(){
        $ac=@$_GET['ac'];
        if($ac>''){
            $method='ac_'.$ac;
            if(method_exists($this,$method)){
                $this->$method();
                exit();
            }
        }
    }
    /**
     *
     */
    public function ac_phpinfo(){
        phpinfo();
    }
    /**
     *
     */
    public function ac_functions(){
        $ac=@$_GET['ac'];
        var_dump($ac);exit();
    }
    /**
     *
     */
    public function ac_function_check(){
        $value=@$_GET['value'];
        if(function_exists($value)){
            echo color_green('函数存在:'.$value);
        }else{
            echo color_red('函数不存在:'.$value);
        }
    }
    /**
     *
     */
    public function ac_class_check(){
        $value=@$_GET['value'];
        if(class_exists($value)){
            echo color_green('类存在:'.$value);
        }else{
            echo color_red('类不存在:'.$value);
        }
    }
    /**
     *
     */
    public function ac_ext_check(){
        $value=@$_GET['value'];
        if(extension_loaded($value)){
            echo color_green('扩展已加载:'.$value);
        }else{
            echo color_red('扩展未加载:'.$value);
        }
    }
    /**
     * 数据库检测
     * $dsn='mysql:host=localhost;dbname=test;port=3306';
     */
    public function ac_db_check(){
        $dsn    =@$_GET['dsn'];
        $user    =@$_GET['user'];
        $pwd    =@$_GET['pwd'];
//         var_dump($_GET);exit();
//         $dsn='mysql:host=localhost;port=3306';
//         $user='root';
//         $pwd ='root';
        echo "dsn: {$dsn}<br/>\n";
        echo "user: {$user}<br/>\n";
        echo "pwd: {$pwd}<br/>\n";
        try{
            $conn=new \PDO($dsn,$user,$pwd);
            if($conn){
                echo color_green('数据库连接成功');
            }else{
                echo color_red('数据库连接失败');
            }
        }catch(\PDOException $e){
            echo color_red('数据库连接失败');
            echo "<br/>\n";
            echo color_red('异常信息: '.$e->getMessage());
        }
    }
}
class TzTools extends TzBase{
    /**
     * 
     */
    public function tz(){
        $this->db_check();
        //
        $list=[];
        $list['函数是否存在']=$this->form('function_check','printf').' mysql/mysql_query/mb_substr';
        $list['类是否存在']     =$this->form('class_check','mysqli').' Pdo/Reflection';
        $list['扩展是否已加载']=$this->form('ext_check','redis').' redis/memcache';
        echo $this->table('检测函数/类/扩展',$list);
    }
    /**
     *
     */
    public function db_check(){
        $action='db_check';
        $dns ='mysql:host=localhost;port=3306';
        $user='root';
        $pwd ='root';
        $html='<form target="_blank">
                    <input type="hidden" name="ac" value="'.$action.'" />
                    <input type="text"      name="dsn"     value="'.$dns.'"     style="width: 360px;"/>
                    用户名：<input type="text" name="user" value="'.$user.'"     style="width: 50px;"/>
                    密码：<input type="text"     name="pwd"     value="'.$pwd.'"     style="width: 50px;"/>
                    <button type="submit">提交</button>
                </form>
                ';
        $list=[];
        $list[color_red('mysql')]=$html;
        $list['']='如果也要检测数据库: mysql:host=localhost;port=3306;dbname=test';
        echo $this->table(color_red('数据库连接测试'),$list);
    }
}
(new TzActions())->tz();

?>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PHP探针 | Powered by MoreTZ</title>
<style type="text/css">
body{
    font-family: "Microsoft YaHei","微软雅黑",Arial,"Micro Hei",SimSun,"宋体",Heiti,"黑体",sans-serif;
    font-size: 14px;
    
    width: 960px;
    margin: 0 auto;    
}
table {
    width: 100%;
    padding: 0;
    margin-top:28px;
    border-collapse: collapse;
    border-spacing: 0;
    box-shadow: 1px 1px 1px #CCC;
}
td,th{
    padding: 5px 10px;
    border: 1px solid #ccc;
    word-break: break-all;
}
td>table,
th>table{
    margin: -5px -10px;
    margin:0;
    box-shadow: none;
}
th{
    background: #ddd;
}
tr>td:first-child{
    background: #efefef;
}
h1{
    font-weight: 100;
    text-align: center;
    padding: 9px 0;

    margin-bottom: 10px;
    border-bottom: 1px solid #eee;
    margin: 20px 0 10px 0;
}
i{
    color: #ccc;    
}
.extensions,
.danger-funcs
{
    word-break: break-all;
}
.extensions>span,
.danger-funcs>b
{
    padding: 0 10px;
    display: inline-block;    
}
form{
    display:inline-block;
}
</style>
</head>
<body>
<h1>PHP探针</h1>
<?php
(new TzServerInfo())->tz();
(new TzPhpInfo())->tz();
(new TzTools())->tz();
?>
<br/>
<br/>
<br/>
</body>
</html>
<!-- 
Code By 甜力怕
Gitee https://gitee.com/xiaozhu2007
Github https://github.com/xiaozhu2007
此页面由 MoreTZ 构建
-->
