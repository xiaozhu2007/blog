<script>
    (async () => {//使用匿名函数确保body已载入
    /*
    Pig2333BlogHelper_Set 存储在LocalStorage中,用于指示sw安装状态
    0 或不存在 未安装
    1 已打断
    2 已安装
    3 已激活,并且已缓存必要的
    */
        const $ = document.querySelector.bind(document);//语法糖
        if ('serviceWorker' in navigator) { //如果支持sw
            if (Number(window.localStorage.getItem('Pig2333BlogHelper_Set')) < 1) {
                window.localStorage.setItem('Pig2333BlogHelper_Set', 1)
                window.stop()
                document.body.innerHTML = await (await fetch('/notice.html')).text()
            }
            navigator.serviceWorker.register(`/sw.js?time=${ranN(1, 8888888888)}`)//随机数,强制更新
                .then(async () => {
                    if (Number(window.localStorage.getItem('Pig2333BlogHelper_Set')) < 2) {
                         setTimeout(() => {
                             window.localStorage.setItem('Pig2333BlogHelper_Set', 2)
                             //window.location.search = `?time=${ranN(1, 88888888888888888)}` //已弃用,在等待500ms安装成功后直接刷新没有问题
                             window.location.reload()//刷新,以载入sw.js
                        }, 1000)//安装后等待1000ms使其激活
                    }
                 })
                .catch(err => console.error(`Pig2333BlogHelperError:${err}`))
        }
    })()
    function loadScript(src, callback) {
        var script = document.createElement('script'),
            head = document.getElementsByTagName('head')[0];
        script.type = 'text/javascript';
        script.charset = 'UTF-8';
        script.src = src;
        if (script.addEventListener) {
            script.addEventListener('load', function () {
                callback();
            }, false);
        } else if (script.attachEvent) {
            script.attachEvent('onreadystatechange', function () {
                var target = window.event.srcElement;
                if (target.readyState == 'loaded') {
                    callback();
                }
            });
        }
        head.appendChild(script);
    }
    document.onreadystatechange = function () {
        if (document.readyState == "complete") {
            //loadScript('/hpp/api/getblogeractive', function () { });
            //loadScript('https://npm.elemecdn.com/notyf@3.10.0/notyf.min.js', function () { });
        }
    }
</script>
<script src="https://npm.elemecdn.com/notyf@3/notyf.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
<script>
    // Create an instance of Notyf
    var notyf = new Notyf();
    // Display a success notification
    notyf.success({
        message: '您已启用JavaScript, 并享受全球加速中!',
        duration: 500,
        dismissible: true,
        icon: true
    });
</script>
